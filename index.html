<!-- index.html (only the <script> section changed) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Â· Rosebel Street Soccer</title>
  <link rel="stylesheet" href="style.css">
  <script defer src="script.js"></script>
</head>
<body data-page="dashboard">

<nav class="topnav">
  <div class="brand">Rosebel Street Soccer</div>
  <ul>
    <li><a href="index.html" class="active">Dashboard</a></li>
    <li><a href="teams.html">Teams</a></li>
    <li><a href="players.html">Players</a></li>
    <li><a href="matches.html">Matches</a></li>
    <li><a href="standings.html">Standings</a></li>
    <li><a href="knockout.html">Knockout</a></li>
  </ul>
</nav>

<header class="page-header"><h1>Dashboard</h1></header>
<main class="container">
  <section class="card" id="summary">
    <h2>Tournament Summary</h2>
    <div class="grid">
      <div class="stat"><div class="stat-value" id="statTeams">0</div><div class="stat-label">Teams</div></div>
      <div class="stat"><div class="stat-value" id="statPlayers">0</div><div class="stat-label">Players</div></div>
      <div class="stat"><div class="stat-value" id="statMatches">0</div><div class="stat-label">Matches</div></div>
    </div>
  </section>

  <section class="card">
    <h2>Reset Everything</h2>
    <button class="btn sm danger" id="resetAllBtn">Delete All Data</button>
  </section>

  <section class="card">
    <h2>Backup & Restore</h2>
    <div class="grid grid-2">
      <div>
        <button class="btn sm primary" id="exportBtn">Download Backup (.json)</button>
      </div>
      <div>
        <input type="file" id="importFile" accept=".json" style="display:none;">
        <button class="btn sm" id="importBtn">Choose File to Restore</button>
        <div id="importFileName" style="margin-top:.4rem;font-size:.85rem;color:#aaa;">No file selected</div>
      </div>
    </div>
  </section>
</main>

<script>
  const keys = ['teams','players','matches','bracket'];

  document.getElementById('exportBtn').addEventListener('click', () => {
    const data = {};
    keys.forEach(k => { const v = localStorage.getItem(k); if(v) data[k] = v; });
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `rosebel-backup-${new Date().toISOString().slice(0,10)}.json`;
    a.click();
    URL.revokeObjectURL(url);
  });

  const importInput = document.getElementById('importFile');
  const fileNameDiv = document.getElementById('importFileName');
  document.getElementById('importBtn').addEventListener('click', () => importInput.click());

  importInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    fileNameDiv.textContent = file.name;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const data = JSON.parse(ev.target.result);
        if (!data.teams || !Array.isArray(data.teams)) throw new Error('Invalid teams');
        if (data.teams.length > 8) throw new Error('Backup has more than 8 teams');
        
        if (confirm('This will ERASE all current data. Continue?')) {
          localStorage.clear();
          keys.forEach(k => {
            if (data[k] !== undefined) {
              if (k === 'teams' && data[k].length > 8) return;
              localStorage.setItem(k, JSON.stringify(data[k]));
            }
          });
          alert('Backup restored! Reloading...');
          location.reload();
        }
      } catch (err) {
        alert('Invalid or corrupted backup: ' + err.message);
        fileNameDiv.textContent = 'Error';
      }
    };
    reader.readAsText(file);
  });

  document.getElementById('resetAllBtn').addEventListener('click', () => {
    if (confirm('Delete EVERYTHING? This cannot be undone.')) {
      localStorage.clear();
      location.reload();
    }
  });

  function updateStats() {
    const teams = JSON.parse(localStorage.getItem('teams') || '[]').length;
    const playersObj = JSON.parse(localStorage.getItem('players') || '{}');
    const players = Object.values(playersObj).reduce((sum, arr) => sum + (Array.isArray(arr) ? arr.length : 0), 0);
    const matches = JSON.parse(localStorage.getItem('matches') || '[]').length;
    byId('statTeams').textContent = teams;
    byId('statPlayers').textContent = players;
    byId('statMatches').textContent = matches;
  }
  updateStats();
  window.addEventListener('storage', updateStats);
</script>
</body>
</html>